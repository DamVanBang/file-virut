#!/usr/bin/env node

// External Dependencies
var argv = require('optimist').argv;
var fs = require('fs');

// Internal Dependencies
var Builder = require('./lib/builder');

// Shortcuts

// Module vars

// Default parameters
var root = process.cwd(),
    filename = root + '/index.js',
    output = root + '/output.js',
    min = false;

// build.json parameters
if (fs.existsSync(root + '/build.json')) {
    var module = require(root + '/build.json');
    filename = module.filename || filename;
    output = module.output || output;
    root = module.root || root;
    if (module.min !== undefined) {
        min = module.min;
    }
}

// CLI parameters
filename = argv._[0] || argv.filename || argv.f || argv.input || filename;
output = argv.output || argv.o || output;
root = argv.root || argv.r || root;
if (argv.min !== undefined) {
    min = argv.min;
}
if (argv.m !== undefined) {
    min = argv.m;
}

var builder = new Builder({
    filename: filename,
    output: output,
    root: root,
    min: min
});
builder.build();